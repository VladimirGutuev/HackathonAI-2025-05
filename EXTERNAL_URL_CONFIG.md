# Настройка EXTERNAL_URL для переключения между ngrok и сервером

## Описание

Переменная `EXTERNAL_URL` используется для настройки внешнего URL, который будет использоваться для callback'ов от SUNO API при генерации музыки.

## Настройка для локальной разработки с ngrok

Добавьте в файл `.env` следующую строку:

```
EXTERNAL_URL=https://your-ngrok-url.ngrok-free.app
```

Замените `your-ngrok-url` на ваш реальный ngrok URL.

## Настройка для продакшн сервера

Добавьте в файл `.env` следующую строку:

```
EXTERNAL_URL=https://your-domain.com
```

Замените `your-domain.com` на ваш реальный домен.

## Автоматическое определение

Если переменная `EXTERNAL_URL` не установлена, система автоматически будет использовать `request.host_url` (например, `http://localhost:5000` для локальной разработки).

## Пример полного файла .env

```
OPENAI_API_KEY=your-openai-api-key
SUNOAI_API_KEY=your-suno-api-key
EXTERNAL_URL=https://your-ngrok-url.ngrok-free.app
```

## Как это работает

1. При генерации музыки система использует `EXTERNAL_URL` для формирования callback URL
2. SUNO API отправляет уведомления о готовности музыки на этот URL
3. Система получает callback и обновляет статус задачи генерации музыки

## Переключение между окружениями

- **Локальная разработка**: Установите `EXTERNAL_URL` на ваш ngrok URL
- **Продакшн**: Установите `EXTERNAL_URL` на домен вашего сервера
- **Тестирование**: Закомментируйте `EXTERNAL_URL` для использования localhost 